<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Gestor de Tareas</title>
</h:head>

<h:body>
    <h:form id="growlForm">
        <p:growl id="msgs" showDetail="true" life="3000"/>
    </h:form>

    <h:form id="formCrear">
        <p:panel header="Crear nueva tarea">
            <div class="p-grid">
                <div class="p-col-6">
                    <h:outputLabel for="nombre" value="Título:" />
                    <p:inputText id="nombre" value="#{taskController.nombre}" required="true" maxlength="100" style="width:100%"/>
                </div>
                <div class="p-col-6">
                    <h:outputLabel for="desc" value="Descripción:" />
                    <p:inputTextarea id="desc" value="#{taskController.descripcion}" autoResize="true" rows="3" style="width:100%"/>
                </div>
            </div>
            <div class="p-mt-2 p-d-flex p-jc-end">
                <p:commandButton value="Agregar" icon="pi pi-plus"
                                 actionListener="#{taskController.agregar}"
                                 update=":formListado:tabla :growlForm:msgs @form"
                                 process="@form"/>
            </div>
        </p:panel>
    </h:form>


    <p:spacer height="20"/>

    <h:form id="formListado">
        <p:panel header="Listado de Tareas">
            <p:dataTable id="tabla" value="#{taskController.tareas}" var="t"
                         paginator="true" rows="8" emptyMessage="No hay tareas registradas">

                <p:column headerText="ID" style="width:60px; text-align:center">
                    <h:outputText value="#{t.id}" />
                </p:column>

                <p:column headerText="Título">
                    <h:outputText value="#{t.nombre}" />
                </p:column>

                <p:column headerText="Descripción">
                    <h:outputText value="#{t.descripcion}" />
                </p:column>

                <p:column headerText="Fecha" style="width:130px; text-align:center">
                    <h:outputText value="#{t.fechaCreacion}" />
                </p:column>

                <p:column headerText="Acciones" style="width:220px; text-align:center">

                    <p:commandButton value="Completar" icon="pi pi-check"
                                     actionListener="#{taskController.completar(t)}"
                                     update=":formListado:tabla :growlForm:msgs"
                                     immediate="true"/>

                    <p:commandButton icon="pi pi-trash" styleClass="p-button-danger p-ml-2"
                                     title="Eliminar"
                                     actionListener="#{taskController.prepararEliminar(t)}"
                                     oncomplete="PF('confirmDlg').show()"
                                     process="@this"
                                     immediate="true"
                                     update=":growlForm:msgs"/>
                </p:column>
            </p:dataTable>
        </p:panel>
        <p:confirmDialog widgetVar="confirmDlg" modal="true" header="Confirmación" closable="false">
            <h:outputText value="¿Eliminar la tarea: " />
            <h:outputText value="#{taskController.selectedTarea.nombre}" style="font-weight:bold"/>
            <h:outputText value=" ?" />

            <p:separator/>
            <p:commandButton value="Sí" icon="pi pi-check" styleClass="p-button-danger"
                             actionListener="#{taskController.eliminarSeleccionado}"
                             update=":formListado:tabla :growlForm:msgs"
                             oncomplete="PF('confirmDlg').hide()"/>

            <p:commandButton value="No" icon="pi pi-times"
                             styleClass="p-button-secondary"
                             onclick="PF('confirmDlg').hide(); return false;"/>
        </p:confirmDialog>
    </h:form>
</h:body>
</html>
